<% content_for :head do %>

<script type="text/javascript" src="/javascripts/jquery.tablesorter.js"></script>

  <% javascript_tag do %>

    $(document).ready(function(){

      
      $("table#benchmark").tablesorter();

      filters$ = $("table#filter td select")
      
      filters$.live('change', function(){

        cells$ = $("table#benchmark tbody tr td").not(".dummy");
        
        renderLoadingGif(cells$);
        query = encodeURI($(this).attr('id') + "=" + $(this).attr('value').replace(/&/, "%26"));

        jQuery.ajax({
          data:     query,
          dataType: 'script',
          type:     'post',
          url:      '/benchmark/update'
        });
      });

      manageTableStyle();
      manageAddedRows();

    });

    function manageTableStyle() {
      tableRowBackgroundColor($("table#benchmark tbody tr:odd"), '#f0f0ff');
      tableRowBackgroundColor($("table#benchmark tbody tr:even"), 'White');

      tableHeaderWidth();

    }

    function manageAddedRows() {
      $("table#benchmark tbody tr#my-company").children("td").each(function(){
          $(this).css('background',"#e8ffe8");
      });

      $("table#benchmark tbody tr#sector-average").children("td").each(function(){
          $(this).css('background',"#5e5e5e").css('color', 'White');
      });

      scrollToMyCompany();
    }

    function scrollToMyCompany() {
      container = $("table#benchmark tbody");
      height = container.height();
      contentHeight = container.attr('scrollHeight');
      if (contentHeight > height) {
        row = $("table#benchmark tbody tr#my-company");
        position = row.position();
        container.animate({scrollTop: position.top-(height/2)}, 2000);
      }
    }

    function tableRowBackgroundColor(rows,color) {
      $(rows).each(function() {
        cells$ = $(this).children("td");
        cells$.each(function(){
          $(this).css('background',color);
        });
      });
    }

    function tableHeaderWidth() {
      tableBody$ = $("table#benchmark > tbody");
      dummyCell$ = $("table#benchmark th.dummy");
      if (tableBody$.height() == 285) {
        dummyCell$.width("28px");
      } else {
        dummyCell$.width("0px");
      }

    }

  <% end %>
<% end %>